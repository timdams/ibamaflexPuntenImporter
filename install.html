<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Install Grade Importer</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: #1f2937;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 500px;
        }

        h1 {
            margin-top: 0;
            color: #111827;
        }

        p {
            color: #6b7280;
            margin-bottom: 2rem;
        }

        .bookmarklet-button {
            display: inline-block;
            background-color: #2563eb;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.125rem;
            cursor: move;
            border: 2px dashed #93c5fd;
        }

        .bookmarklet-button:hover {
            background-color: #1d4ed8;
            border-color: #60a5fa;
        }

        .instruction {
            margin-top: 2rem;
            font-size: 0.875rem;
            background: #eff6ff;
            padding: 1rem;
            border-radius: 0.5rem;
            color: #1e3a8a;
        }
    </style>
</head>

<body>
    <div class="card">
        <h1>Grade Importer Installer (v3)</h1>
        <p>This version uses <strong>Strict Matching</strong> (ignores <code>[B]</code> suffixes).</p>

        <a class="bookmarklet-button"
            href="javascript:(function(){var s=document.createElement('script');s.src='https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js';s.onload=function(){var css='#gi-overlay{position:fixed;top:20px;right:20px;width:320px;background:white;border:1px solid #ccc;box-shadow:0 4px 12px rgba(0,0,0,0.15);z-index:99999;padding:20px;font-family:sans-serif;border-radius:8px;font-size:14px}#gi-header{font-weight:bold;font-size:16px;margin-bottom:15px;display:flex;justify-content:space-between;border-bottom:1px solid #eee;padding-bottom:10px}.gi-label{display:block;margin-bottom:4px;font-weight:500;color:#555}.gi-select{width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;margin-bottom:10px}.gi-btn{background:#2563eb;color:white;border:none;padding:10px;border-radius:4px;cursor:pointer;width:100%;font-weight:bold;margin-top:10px}.gi-btn:disabled{background:#ccc}';var style=document.createElement('style');style.textContent=css;document.head.appendChild(style);var d=document.createElement('div');d.id='gi-overlay';d.innerHTML='<div id=\'gi-header\'><span>Import Grades</span><span onclick=\'this.parentElement.parentElement.remove()\' style=\'cursor:pointer\'>&times;</span></div><input type=\'file\' id=\'gi-file\' accept=\'.xlsx\' style=\'width:100%;margin-bottom:15px\'/><div id=\'gi-map\' style=\'display:none\'><label class=\'gi-label\'>Student Column</label><select id=\'gi-col-name\' class=\'gi-select\'></select><label class=\'gi-label\'>Grade Column</label><select id=\'gi-col-grade\' class=\'gi-select\'></select></div><button id=\'gi-btn\' class=\'gi-btn\' disabled>Import</button><div id=\'gi-msg\' style=\'margin-top:10px;color:#666\'>Select Excel file</div>';document.body.appendChild(d);var wb,json;document.getElementById('gi-file').onchange=function(e){var f=e.target.files[0];if(!f)return;var r=new FileReader();r.onload=function(e){wb=XLSX.read(e.target.result,{type:'array'});json=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);if(json.length){var h=Object.keys(json[0]);var sn=document.getElementById('gi-col-name');var sg=document.getElementById('gi-col-grade');[sn,sg].forEach(s=>{s.innerHTML='';h.forEach(o=>{var opt=document.createElement('option');opt.value=o;opt.text=o;s.add(opt)})});document.getElementById('gi-map').style.display='block';document.getElementById('gi-btn').disabled=false;document.getElementById('gi-msg').textContent='Map columns and click Import';}else{document.getElementById('gi-msg').textContent='Empty file';}};r.readAsArrayBuffer(f)};document.getElementById('gi-btn').onclick=function(){var nk=document.getElementById('gi-col-name').value;var sk=document.getElementById('gi-col-grade').value;var rows=document.querySelectorAll('#ctl00_ctl00_cphGeneral_cphMain_rgPuntenP_ctl00 tbody tr');let m=0,nf=0;rows.forEach(r=>{var nc=r.cells[1];if(!nc)return;var dn=nc.textContent.trim().replace(/\s*\[.*?\]$/,'').trim().toLowerCase();var rec=json.find(d=>{var en=String(d[nk]).trim().toLowerCase();return dn===en});if(rec){var ipt=r.querySelector('input[name*=\'txtScore\']');if(ipt){ipt.value=rec[sk];ipt.style.backgroundColor='#d4edda';m++}}else{nf++}});document.getElementById('gi-msg').innerHTML='Matched: '+m+'<br>Not Found: '+nf}};document.head.appendChild(s)})();">
            ⬇️ Drag Me to Bookmarks Bar ⬇️
        </a>

        <div class="instruction">
            <strong>Updated:</strong> Please maintain 1-to-1 name matching.
        </div>
    </div>
</body>

</html>